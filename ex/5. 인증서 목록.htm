<span>5. 인증서 목록</span>
<br />
<select id="storage" style="width: 150px" onchange="selectStorage(this);"></select>
<br />
<span id="msg" style="color: red;"></span>
<style>
    .list {
        width: 100%;
    }
    th, td {
        border: 1px solid #444444;
    }
</style>
<table class="list">
    <tr>
        <th>순번</th><th>소유자명</th><th>용도</th><th>발급기관</th><th>만료일</th>
    </tr>
</table>
<script>
    function getStorageName(type) {
        var name = '';
        switch (type) {
            case 'Local':
            case 'Fixed':
                name = '로컬 디스크';
                break;
            case 'CDROM':
                name = 'CD-ROM';
                break;
            case 'Removable':
                name = '이동식 디스크';
                break;
        }
        return name;
    }

    function getOidList() {
        var oid = "";
        oid += " |전자관인|1.2.410.100001.2.1.1;";
        oid += " |컴퓨터|1.2.410.100001.2.1.2;";
        oid += " |전자목적용|1.2.410.100001.2.1.3;";
        oid += " |전자관인(공공/민간)|1.2.410.100001.2.1.4;";
        oid += " |컴퓨터(공공/민간)|1.2.410.100001.2.1.5;";
        oid += " |특수목적용(공공/민간)|1.2.410.100001.2.1.6;";
        oid += " |공무원용|1.2.410.100001.2.2.1;";
        oid += " |개인용|1.2.410.100001.2.2.2;";
        oid += " |전자관인용|1.2.410.100001.5.3.1.1;";
        oid += " |개인용|1.2.410.100001.5.3.1.3;";
        oid += " |특수목적용|1.2.410.100001.5.3.1.5;";
        oid += " |컴퓨터용|1.2.410.100001.5.3.1.7;";
        oid += " |SSL용|1.2.410.100001.5.3.1.9;";
        oid += "한국증권전산|용도제한(스페셜 개인)|1.2.410.200004.5.1.1.1;";
        oid += "한국증권전산|용도제한(스페셜 개인서버)|1.2.410.200004.5.1.1.2;";
        oid += "한국증권전산|용도제한(스페셜 법인)|1.2.410.200004.5.1.1.3;";
        oid += "한국증권전산|용도제한(스페셜 서버)|1.2.410.200004.5.1.1.4;";
        oid += "한국증권전산|범용개인|1.2.410.200004.5.1.1.5;";
        oid += "한국증권전산|범용개인서버|1.2.410.200004.5.1.1.6;";
        oid += "한국증권전산|범용기업|1.2.410.200004.5.1.1.7;";
        oid += "한국증권전산|범용서버|1.2.410.200004.5.1.1.8;";
        oid += "한국증권전산|증권/보험용|1.2.410.200004.5.1.1.9;";
        oid += "한국증권전산|신용카드용|1.2.410.200004.5.1.1.9.2;";
        oid += "한국증권전산|골드 개인서버|1.2.410.200004.5.1.1.10;";
        oid += "한국증권전산|국세청용(개인)|1.2.410.200004.5.1.1.11;";
        oid += "한국증권전산|국세청용(법인)|1.2.410.200004.5.1.1.12;";
        oid += "한국정보인증|범용기업|1.2.410.200004.5.2.1.1;";
        oid += "한국정보인증|범용개인|1.2.410.200004.5.2.1.2;";
        oid += "한국정보인증|특별등급(전자입찰)|1.2.410.200004.5.2.1.3;";
        oid += "한국정보인증|1등급인증서(서버)|1.2.410.200004.5.2.1.4;";
        oid += "한국정보인증|특별등급 법인|1.2.410.200004.5.2.1.5;";
        oid += "한국정보인증|용도제한(NEIS)|1.2.410.200004.5.2.1.5.140;";
        oid += "한국정보인증|건강보험심사평가원 업무전용 인증서|1.2.410.200004.5.2.1.5.407;";
        oid += "한국정보인증|용도제한(법인)|1.2.410.200004.5.2.1.6;";
        oid += "한국정보인증|은행개인|1.2.410.200004.5.2.1.7.1;";
        oid += "한국정보인증|증권/보험용|1.2.410.200004.5.2.1.7.2;";
        oid += "한국정보인증|신용카드용|1.2.410.200004.5.2.1.7.3;";
        oid += "한국정보인증|국세청용(개인,법인)|1.2.410.200004.5.2.1.5001;";
        oid += "한국전산원|1등급(기관/단체)|1.2.410.200004.5.3.1.1;";
        oid += "한국전산원|범용법인|1.2.410.200004.5.3.1.2;";
        oid += "한국전산원|1등급(서버)|1.2.410.200004.5.3.1.3;";
        oid += "한국전산원|용도제한(개인)|1.2.410.200004.5.3.1.4;";
        oid += "한국전산원|특수목적용(기관/단체)|1.2.410.200004.5.3.1.5;";
        oid += "한국전산원|특수목적용(법인)|1.2.410.200004.5.3.1.6;";
        oid += "한국전산원|특수목적용(서버)|1.2.410.200004.5.3.1.7;";
        oid += "한국전산원|특수목적용(개인)|1.2.410.200004.5.3.1.8;";
        oid += "한국전산원|범용개인|1.2.410.200004.5.3.1.9;";
        oid += "한국전자인증|범용개인|1.2.410.200004.5.4.1.1;";
        oid += "한국전자인증|범용기업|1.2.410.200004.5.4.1.2;";
        oid += "한국전자인증|범용(서버)|1.2.410.200004.5.4.1.3;";
        oid += "한국전자인증|특수목적용(개인)|1.2.410.200004.5.4.1.4;";
        oid += "한국전자인증|특수목적용(법인)|1.2.410.200004.5.4.1.5;";
        oid += "한국전자인증|은행개인|1.2.410.200004.5.4.1.101;";
        oid += "한국전자인증|증권거래용|1.2.410.200004.5.4.1.102;";
        oid += "한국전자인증|신용카드용|1.2.410.200004.5.4.1.103;";
        oid += "한국전자인증|전자민원용|1.2.410.200004.5.4.1.104;";
        oid += "한국전자인증|국세청용(개인)|1.2.410.200004.5.4.1.74;";
        oid += "한국전자인증|국세청용|1.2.410.200004.5.4.2.52;";
        oid += "금융결제원|범용(개인)|1.2.410.200005.1.1.1;";
        oid += "금융결제원|은행/신용카드/보험용(법인/단체)|1.2.410.200005.1.1.2;";
        oid += "금융결제원|서버용(법인/단체)|1.2.410.200005.1.1.3;";
        oid += "금융결제원|은행/신용카드/보험용(개인)|1.2.410.200005.1.1.4;";
        oid += "금융결제원|범용(법인/단체)|1.2.410.200005.1.1.5;";
        oid += "금융결제원|용도제한용|1.2.410.200005.1.1.6;";
        oid += "금융결제원|기업뱅킹용|1.2.410.200005.1.1.6.1;";
        oid += "금융결제원|신용카드용|1.2.410.200005.1.1.6.2;";
        oid += "금융결제원|조달청 원클릭용(법인/단체)|1.2.410.200005.1.1.6.3;";
        oid += "금융결제원|퇴직연금|1.2.410.200005.1.1.6.4;";
        oid += "금융결제원|재정경제부 CTR용(법인/단체)|1.2.410.200005.1.1.6.5;";
        oid += "금융결제원|전자세금용|1.2.410.200005.1.1.6.8;";
        oid += "|국방공무원|1.2.410.200006.2.1;";
        oid += "|공인인증기관|1.2.410.200004.2.1;";
        oid += "한국무역정보통신|전자거래 서명용(개인)|1.2.410.200012.1.1.1;";
        oid += "한국무역정보통신|전자거래 암호용(개인)|1.2.410.200012.1.1.2;";
        oid += "한국무역정보통신|전자거래 서명용(법인)|1.2.410.200012.1.1.3;";
        oid += "한국무역정보통신|전자거래 암호용(법인)|1.2.410.200012.1.1.4;";
        oid += "한국무역정보통신|전자거래 서명용(서버)|1.2.410.200012.1.1.5;";
        oid += "한국무역정보통신|전자거래 암호용(서버)|1.2.410.200012.1.1.6;";
        oid += "한국무역정보통신|전자무역 서명용(개인)|1.2.410.200012.1.1.7;";
        oid += "한국무역정보통신|전자무역 암호용(개인)|1.2.410.200012.1.1.8;";
        oid += "한국무역정보통신|전자무역 서명용(법인)|1.2.410.200012.1.1.9;";
        oid += "한국무역정보통신|전자무역 암호용(법인)|1.2.410.200012.1.1.10;";
        oid += "한국무역정보통신|전자무역 서명용(서버)|1.2.410.200012.1.1.11;";
        oid += "한국무역정보통신|전자무역 암호용(서버)|1.2.410.200012.1.1.12;";
        oid += "한국무역정보통신|은행/보험용|1.2.410.200012.1.1.101;";
        oid += "한국무역정보통신|증권/보험용|1.2.410.200012.1.1.103;";
        oid += "한국무역정보통신|신용카드용|1.2.410.200012.1.1.105;";
        oid += " |KEI/업무용|1.2.410.200057.2.1.1;";
        oid += " |매직가드|1.2.3.4.5;";
        oid += " |하이포탈|1.2.410.200057.2.5;";
        oid += " |포탈로그인|1.2.410.200057.2.6;";
        oid += " |범용(개인)|1.2.410.200004.5.5.1.1;";
        oid += " |범용(기업)|1.2.410.200004.5.5.1.2;";
        oid += " |제휴기관용(개인)|1.2.410.200004.5.5.1.3.1;";
        oid += " |제휴기관용(기업)|1.2.410.200004.5.5.1.4.1;";
        oid += " |전자세금용(기업)|1.2.410.200004.5.5.1.4.2;";

        return oid;
    }

    function getCertpolicy(oid) {
        var o =
            oid.split(".").length > 8 && oid.indexOf("1.2.410.200004.5.2.1.6") > -1
                ? oid.substr(0, oid.lastIndexOf("."))
                : oid;
        var re = "([^|]+)[|]([^|]+)[|]" + o + "[.;]{1}";
        var use = this.getOidList().match(re) || [];
        return use.length > 0 ? use[2] : oid;
    }

    (function call() {
        _engine.api.selectStorageInfo()
            .then(function (data) {
                var storage = document.querySelector("#storage");

                var opt = document.createElement("option");
                opt.text = '디스크 선택';
                opt.value = '';
                storage.options.add(opt);

                data.result.forEach(function (obj) {
                    var opt = document.createElement("option");
                    opt.text = getStorageName(obj.type) + ' (' + obj.diskname + ')';
                    opt.value = obj.diskname;
                    storage.options.add(opt);
                });
            })
            .catch(function (error) {
                console.log(error);
            });
    })();

    function selectStorage(el) {
        var list = document.querySelector(".list");
        var html = '<tr><th>순번</th><th>소유자명</th><th>용도</th><th>발급기관</th><th>만료일</th></tr>';
        list.innerHTML = html;
        if (el.value.length > 0) {
            _engine.api.getCertList(el.value)
                .then(function (data) {
                    data.result.forEach(function (obj) {

                        var subjectname = obj.subjectname.replace(/cn=([^=,]+),.*/, "$1");
                        var policyid = getCertpolicy(obj.certpolicy.replace(/\r/g, "").replace(/\n/g, "").replace(/.*Policy Identifier=([0-9.]+).*/gi, "$1"));
                        var issuername = obj.Issuer.replace(/cn=([^=,]+).*/, "$1");
                        var enddate = obj.after.split(" ")[0];

                        html += '<tr><td>' + obj.certIdx + '</td><td>' + subjectname + '</td><td>' + policyid + '</td><td>' + issuername + '</td><td>' + enddate + '</td></tr>';
                    });
                    list.innerHTML = html;
                })
                .catch(function (error) {
                    console.log(error);
                });
        }
    }
</script>
